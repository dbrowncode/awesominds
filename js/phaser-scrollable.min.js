/*! phaser-scrollable 09-02-2017 */
var ScrollableArea=function(a,b,c,d,e){e=e||{},Phaser.Group.call(this,game),this._x=this.x=a,this._y=this.y=b,this._w=c,this._h=d,this.maskGraphics=game.add.graphics(a,b),this.maskGraphics.beginFill(0),this.maskGraphics.drawRect(0,0,c,d),this.maskGraphics.alpha=.2,this.maskGraphics.inputEnabled=!0,this.mask=this.maskGraphics,this.dragging=!1,this.pressedDown=!1,this.timestamp=0,this.callbackID=0,this.targetX=0,this.targetY=0,this.autoScrollX=!1,this.autoScrollY=!1,this.startX=0,this.startY=0,this.velocityX=0,this.velocityY=0,this.amplitudeX=0,this.amplitudeY=0,this.directionWheel=0,this.velocityWheelX=0,this.velocityWheelY=0,this.settings={kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!0,verticalScroll:!0,horizontalWheel:!1,verticalWheel:!0,deltaWheel:40},this.configure(e),this.addChild=function(a){this.maskGraphics.x=this.parent.x+this._x,this.maskGraphics.y=this.parent.y+this._y,ScrollableArea.prototype.addChild.call(this,a)}};ScrollableArea.prototype=Object.create(Phaser.Group.prototype),ScrollableArea.prototype.constructor=ScrollableArea,ScrollableArea.prototype.configure=function(a){if(a)for(var b in a)this.settings.hasOwnProperty(b)&&(this.settings[b]=a[b])},ScrollableArea.prototype.start=function(){this.game.input.onDown.add(this.beginMove,this),this.callbackID=this.game.input.addMoveCallback(this.moveCanvas,this),this.game.input.onUp.add(this.endMove,this),this.game.input.mouse.mouseWheelCallback=this.mouseWheel.bind(this)},ScrollableArea.prototype.beginMove=function(){this.allowScrollStopOnTouch&&this.scrollTween&&this.scrollTween.pause(),this.maskGraphics.getBounds().contains(this.game.input.x,this.game.input.y)?(this.startedInside=!0,this.startX=this.game.input.x,this.startY=this.game.input.y,this.pressedDown=!0,this.timestamp=Date.now(),this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0):this.startedInside=!1},ScrollableArea.prototype.moveCanvas=function(a,b,c){if(this.pressedDown){this.now=Date.now();var d=this.now-this.timestamp;if(this.timestamp=this.now,this.settings.horizontalScroll){var e=b-this.startX;0!==e&&(this.dragging=!0),this.startX=b,this.velocityX=.8*(1e3*e/(1+d))+.2*this.velocityX,this.x+=e}if(this.settings.verticalScroll){var e=c-this.startY;0!==e&&(this.dragging=!0),this.startY=c,this.velocityY=.8*(1e3*e/(1+d))+.2*this.velocityY,this.y+=e}this.limitMovement()}},ScrollableArea.prototype.endMove=function(){if(this.startedInside){if(this.pressedDown=!1,this.autoScrollX=!1,this.autoScrollY=!1,!this.settings.kineticMovement)return;this.now=Date.now(),this.game.input.activePointer.withinGame&&((this.velocityX>10||this.velocityX<-10)&&(this.amplitudeX=.8*this.velocityX,this.targetX=Math.round(this.x+this.amplitudeX),this.autoScrollX=!0),(this.velocityY>10||this.velocityY<-10)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(this.y+this.amplitudeY),this.autoScrollY=!0)),this.game.input.activePointer.withinGame||(this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.settings.horizontalScroll&&(this.velocityWheelXAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollX=!0),this.settings.verticalScroll&&(this.velocityWheelYAbs<.1||!this.game.input.activePointer.withinGame)&&(this.autoScrollY=!0))}},ScrollableArea.prototype.scrollTo=function(a,b,c,d,e){this.scrollTween&&this.scrollTween.pause(),a=a>0?-a:a,b=b>0?-b:b,d=d||Phaser.Easing.Quadratic.Out,c=c||1e3,e=e||!1,this.allowScrollStopOnTouch=e,this.scrollTween=game.add.tween(this),this.scrollTween.to({x:a,y:b},c,d).start()},ScrollableArea.prototype.update=function(){if(this.elapsed=Date.now()-this.timestamp,this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.autoScrollX&&0!=this.amplitudeX){var a=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll);a>.5||a<-.5?this.x=this.targetX+a:this.autoScrollX=!1}if(this.autoScrollY&&0!=this.amplitudeY){var a=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll);a>.5||a<-.5?this.y=this.targetY+a:this.autoScrollY=!1}this.autoScrollX||this.autoScrollY||(this.dragging=!1),this.settings.horizontalWheel&&this.velocityWheelXAbs>.1&&(this.dragging=!0,this.amplitudeX=0,this.autoScrollX=!1,this.x+=this.velocityWheelX,this.velocityWheelX*=.95),this.settings.verticalWheel&&this.velocityWheelYAbs>.1&&(this.dragging=!0,this.autoScrollY=!1,this.y+=this.velocityWheelY,this.velocityWheelY*=.95),this.limitMovement()},ScrollableArea.prototype.mouseWheel=function(a){if(this.settings.horizontalWheel||this.settings.verticalWheel){a.preventDefault();var b=120*this.game.input.mouse.wheelDelta/this.settings.deltaWheel;this.directionWheel!=this.game.input.mouse.wheelDelta&&(this.velocityWheelX=0,this.velocityWheelY=0,this.directionWheel=this.game.input.mouse.wheelDelta),this.settings.horizontalWheel&&(this.autoScrollX=!1,this.velocityWheelX+=b),this.settings.verticalWheel&&(this.autoScrollY=!1,this.velocityWheelY+=b)}},ScrollableArea.prototype.stop=function(){this.game.input.onDown.remove(this.beginMove,this),this.callbackID?this.game.input.deleteMoveCallback(this.callbackID):this.game.input.deleteMoveCallback(this.moveCanvas,this),this.game.input.onUp.remove(this.endMove,this),this.game.input.mouse.mouseWheelCallback=null},ScrollableArea.prototype.setPosition=function(a){a.x&&(this.x+=a.x-this._x,this.maskGraphics.x=this._x=a.x),a.y&&(this.y+=a.y-this._y,this.maskGraphics.y=this._y=a.y)},ScrollableArea.prototype.limitMovement=function(){this.settings.horizontalScroll&&(this.x>this._x&&(this.x=this._x),this.x<-(this.width-this._w-this._x)&&(this.width>this._w?this.x=-(this.width-this._w-this._x):this.x=this._x)),this.settings.verticalScroll&&(this.y>this._y&&(this.y=this._y),this.y<-(this.height-this._h-this._y)&&(this.height>this._h?this.y=-(this.height-this._h-this._y):this.y=this._y))};
