<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
<body>

  <div class="formWrap">
    <div class="createClass">
      <form action="createCourse.php" method="post" id="createCourseForm">
        <!-- could use js to restrict input type here -->
        <table>
          <p>Create a new course based on the alphanumeric course key and name.</p>
          <tr><td>Course ID:</td><td><input type="text" name="courseID" id="courseID" required="true" placeholder="PSYC150"></td></tr>
          <tr><td>Course Name:</td><td><input type="text" name="courseName" id="courseName" required="true" placeholder="PSYCHOLOGY 150"></td</tr>
        </table>
        <input type="submit" value="Create Course" name"createC">
      </form>
      <div id="confirm"></div>
    <div>
      <br>
    <div class='upload'>
      <form action="upload2.php" method="post" enctype="multipart/form-data" id="uploadForm">
        <table>
          <p>Select a .doc or .txt file of questions to upload</p>
          <tr><td><input type="file" name="fileToUpload" id="fileToUpload"></td>
          <td><select>
                <option value ="PSYC150">PSYC150</option>
                <option value ="JAVA151">JAVA151</option>
                </select>
           </td></tr>
          <tr><td><input type="submit" value="Upload file" name="submit"></td></tr>
        </table>
      </form>
      <div id="output"></div>
    </div>
    <br>
    <div class = 'permission'>
      <form action="upload2.php" method="post" id='permissions'>
        <table>
          <p>Grant permissions to another instructor to allow creation of courses and upload  of question files.</p>
          <tr><td>Instructor C number:</td><td><input type="text" name="instructorC" id="instructorC" required ="true" placeholder="CXXXXXXX"></td></tr>
        </table>
        <input type = "submit" value="Give Upload rights" name'grantPermission'>
      </form>
    </div>
  </div>



<!--jquery goes here-->
<script>
var create_output           = '#confirm';
var createForm              = $('#createCourseForm'); 
createForm.submit(function (e) {
  e.preventDefault();
  $.ajax({
    type: createForm.attr('method'),
    url: createForm.attr('action'),
    data: createForm.serialize(),
    success: function(data) {
     $(create_output).html(data);  
      console.log(data);  
    },
  error: function(data) {
    console.log(data);
  },
 });
});
</script>

<script>
//configuration
var max_file_size           = 1048576 * 3; //allowed file size. (1 MB = 1048576)
//var allowed_file_types      = ['application/msword']; //allowed file types
var result_output           = '#output'; //ID of an element for response output
var my_form_id              = '#uploadForm'; //ID of an element for response output
var total_files_allowed     = 1; //Number files allowed to upload

//on form submit
$(my_form_id).on( "submit", function(event) {
    event.preventDefault();
    var proceed = true; //set proceed flag
    var error = []; //errors
    var total_files_size = 0;

    if(!window.File && window.FileReader && window.FileList && window.Blob){ //if browser doesn't supports File API
        error.push("Your browser does not support new File API! Please upgrade."); //push error text
    }else{
        var total_selected_files = this.elements['fileToUpload'].files.length; //number of files

        //limit number of files allowed
        if(total_selected_files > total_files_allowed){
            error.push( "You have selected "+total_selected_files+" file(s), " + total_files_allowed +" is maximum!"); //push error text
            proceed = false; //set proceed flag to false
        }
         //iterate files in file input field
        $(this.elements['fileToUpload'].files).each(function(i, ifile){
            if(ifile.value !== ""){ //continue only if file(s) are selected
                total_files_size = total_files_size + ifile.size; //add file size to total size
            }
        });

        //if total file size is greater than max file size
        if(total_files_size > max_file_size){
            error.push( "You have "+total_selected_files+" file(s) with total size "+total_files_size+", Allowed size is " + max_file_size +", Try smaller file!"); //push error text
            proceed = false; //set proceed flag to false
        }

        var submit_btn  = $(this).find("input[type=submit]"); //form submit button

        //if everything looks good, proceed with jQuery Ajax
        if(proceed){
            submit_btn.val("Please Wait...").prop( "disabled", true); //disable submit button
            var form_data = new FormData(this); //Creates new FormData object
            var post_url = $(this).attr("action"); //get action URL of form

            //jQuery Ajax to Post form data
            $.ajax({
                url : post_url,
                type: "POST",
                data : form_data,
                contentType: false,
                cache: false,
                processData:false,
                mimeType:"multipart/form-data"
            }).done(function(res){ //
                $(my_form_id)[0].reset(); //reset form
                $(result_output).html(res); //output response from server
                submit_btn.val("Upload file").prop( "disabled", false); //enable submit button once ajax is done
            });
        }
    }

    $(result_output).html(""); //reset output
    $(error).each(function(i){ //output any error to output element
        $(result_output).append('<div class="error">'+error[i]+"</div>");
    });

});
</script>
</body>
</html>
